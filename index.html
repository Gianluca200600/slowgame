<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Slowgame</title>
	<script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
		integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
		crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link rel="stylesheet" href="style.css">
</head>

<body>
	<main>
		<section id="filters">

			<h3>
				Sfoglia il nostro catalogo
			</h3>

			<form>
				<div>
					<div>
						<input class="w-full border rounded-md pl-2" type="text" id="name" name="name"
							placeholder="Cerca un gioco">
					</div>
				</div>

				<div class="grid grid-cols-1 md:grid-cols-2 md:gap-4 my-2 md:my-4">
					<div>
						<label for="player-number">Numero Giocatori</label>
					</div>
					<div>
						<select class="border rounded-md hover:cursor-pointer" id="player-number" name="player-number">
							<option value="0">Qualsiasi</option>
							<option value="1">1</option>
							<option value="2">2</option>
							<option value="3">Fino a 4</option>
							<option value="4">5 o più</option>
						</select>
					</div>
				</div>

				<div class="grid grid-cols-1 md:grid-cols-2 md:gap-4 my-2 md:my-4">
					<div>
						<label for="playing-time">Durata</label>
					</div>
					<div>
						<select class="border rounded-md hover:cursor-pointer" id="playing-time" name="playing-time">
							<option value="0">Qualsiasi</option>
							<option value="1">Meno di 30 minuti</option>
							<option value="2">30-60 minuti</option>
							<option value="3">60-120 minuti</option>
							<option value="4">Più di 120 minuti</option>
						</select>
					</div>
				</div>

				<div>
					<button class="block w-1/5 m-auto border rounded-md hover:bg-stone-300 hover:cursor-pointer"
						type="submit" id="filter-button">
						Filtra
						<i class="fa-solid fa-filter"></i>
					</button>
				</div>
			</form>

		</section>

		<section id="results" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 my-4">

		</section>
	</main>

	<template>
		<div class="border grid p-2">
			<header class="flex gap-2 items-center">
				<figure class="max-w-1/5">

				</figure>
				<h4 class="text-2xl font-bold"><span data-placeholder="title"></span></h4>
			</header>
			<main>
				<p class="max-h-[200px] my-2 overflow-auto">
					<span data-placeholder="description"></span>
				</p>
			</main>

			<footer class="flex justify-between items-center">
				<div>
					<p>
						<i class="fa-solid fa-clock"></i>
						<span data-placeholder="playing-time"></span>
					</p>
				</div>
				<div>
					<p>
						<i class="fa-solid fa-users"></i>
						<span data-placeholder="players"></span>
					</p>
				</div>
			</footer>
		</div>
	</template>

	<script type="text/javascript" src="index.js"></script>
	<script type="module" src="filter.js"></script>
	<script type="module">
		import { filters } from './filter.js';
		document.addEventListener("DOMContentLoaded", () => {
			const filterButton = document.getElementById('filter-button');
			filterButton.addEventListener('click', (event) => {
				event.preventDefault();
				const fetchPromise = fetch('./games/games.json');
				fetchPromise
					.then(response => {
						if (!response.ok) {
							throw new Error('Network response was not ok');
						}
						return response.json();
					})
					.then(data => {
						const filteredGames = data.map(game => {
							const gameCopy = {
								name: game.name || "",
								description: game.description || "",
								playerNumber: game.players || "",
								playingTime: game['playing-time'] || ""
							}
							return gameCopy;
						})
							.filter(game => {

								const nameFilter = filters.name.toLowerCase();
								const playerNumberFilter = filters.playerNumber.toLowerCase();
								const playingTimeFilter = filters.playingTime.toLowerCase();

								if (nameFilter && !game.name.toLowerCase().includes(nameFilter)) {
									return false;
								}
								if (playerNumberFilter && playerNumberFilter !== '0') {
									if (game.players.match(/^\d-\d$/)) {
										const playersArray = game.players.split('-');
										if (playerNumberFilter == '1' && playersArray[1] > 1) {
											return false;
										}
										if (playerNumberFilter == '2' && playersArray[1] > 2 && playersArray[0] < 2) {
											return false;
										}
										if (playerNumberFilter == '3' && playersArray[1] > 4) {
											return false;
										}
										if (playerNumberFilter == '4' && playersArray[0] < 5) {
											return false;
										}
									}
								}
								return true;
							});
						filteredGames.sort(
							(a, b) => {
								return a.name.localeCompare(b.name);
							}
						);
						console.log(filteredGames);
						return filteredGames;
					})
					.then(filteredGames => {
						const resultsElement = document.getElementById('results');
						resultsElement.innerHTML = '';
						filteredGames.forEach(game => {
							const template = document.querySelector('template');
							const cardElement = document.importNode(template.content, true);
							const titleElement = cardElement.querySelector("[data-placeholder='title']");
							const descriptionElement = cardElement.querySelector("[data-placeholder='description']");
							const playingTimeElement = cardElement.querySelector("[data-placeholder='playing-time']");
							const playersElement = cardElement.querySelector("[data-placeholder='players']");

							titleElement.innerHTML = game.name;
							descriptionElement.innerHTML = game.description;
							playingTimeElement.innerHTML = game.playingTime;
							playersElement.innerHTML = game.playerNumber;

							resultsElement.appendChild(cardElement);
						})
					});
			});
		});
	</script>
</body>

</html>